import { Step } from '../../components/Step'
import { Callout, Tabs, Tab, Steps } from "nextra/components"
import { TutorialSchema } from "../../components/TutorialSchema"

# Generate Quick Start Guide

## Assumptions
This guide will take you through the process of using Snaplet `generate` to create realistic, production-like data. 
<Callout emoji="ðŸ“">
If you already have access to a database with production or production-like data you'd prefer to use as a source, you should instead follow the [Snapshot Quick Start](/getting-started/quick-start) guide.
</Callout>

## Prerequisites

- You'll need to have the [Snaplet CLI](/getting-started/installation) installed and have run `snaplet setup` to generate a [`snaplet.config.ts`](/reference/configuration) configuration file for your project.


## Getting Started

For this quick start guide, we're going to assume you're creating a new blog application, and want to use Snaplet `generate` to create seed data that looks and behaves realistically for the application's database .

**In this tutorial, we'll guide you through the process of:**
* Defining a schema for your new database.  
* Creating a data generation plan that defines what data are generated by Snaplet `generate`.
* Generating production-like data for a sample blog application.
* Populating your local development database with the generated production-like data.

Let's get started.

## Preparing your database and schema
Before we can use Snaplet `generate`, we need a new database with an appropriate schema for a blog application. 

### Creating a new database 
You'll need a new Postgres server for your example blog application. [Create](https://www.postgresql.org/docs/current/sql-createdatabase.html) a new Postgres server locally, or use your preferred cloud-based Postgres service. We'll be using [Neon](https://neon.tech/) for this example.

### Defining your database schema
Snaplet relies on a database's schema to understand the relationships between tables and data, and uses this to generate realistic data. 

For your sample blog application, we'll need to define a schema that reflects the relationship between users, authors, posts, and comments. 

<Tabs items={["diagram", "sql"]}>
<Tab>
<TutorialSchema className="nx-mx-auto nx-my-4" />
</Tab>
<Tab>
```sql
CREATE TABLE public."User" (
  id uuid NOT NULL PRIMARY KEY,
  username text NOT NULL,
  email text NOT NULL
);
CREATE TABLE public."Post" (
  id uuid NOT NULL PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  "createdBy" uuid NOT NULL REFERENCES public."User"(id)
);
CREATE TABLE public."Comment" (
  id uuid NOT NULL PRIMARY KEY,
  content text NOT NULL,
  "userId" uuid NOT NULL REFERENCES public."User"(id),
  "postId" uuid NOT NULL REFERENCES public."Post"(id),
  "writtenAt" timestamptz NOT NULL DEFAULT now()
);
```
</Tab>
</Tabs>

The diagram above represents the relationships of your database.

From the SQL tab above, copy the SQL statement and insert this into your database to define your schema. 

## Snaplet generate
We've now got a new database and a schema that lays out the structure of your data, but no actual data. This is where we can now use Snaplet `generate` to seed your database with production-like data.

For your example blog application, let's assume we need the following data:

- A post titled "Hello World!"
- A post author, with an email address that ends with "acme.org."
- Three comments on the post.

It's worth noting what we're not explicitly defining  - that each comment needs to have a separate, unique author, for instance. We're assuming that Snaplet `generate` will fill in the blanks based on your schema and generate realistic data as needed. 

### Defining the data generation plan
In order to have Snaplet generate this data for your blog, we need to translate these requirements into a data generation plan.  

The data generation plan is a set of rules and conditions that guide the data generation process within the Snaplet Data Client. The Snaplet Data Client is in turn is a function that defines how data generation should proceed based on the user-defined data generation plan.  

Let's define your data generation plan.

<CH.Scrollycoding className="generate-tutorial-configuration-file">

First, we need to define the `generate` key in your [`snaplet.config.ts`](/reference/configuration) file.

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {

  },
});
```

--- 

The `generate` key accepts a `plan` function in which an instance of the Snaplet Data Client is injected as `snaplet`.

```ts snaplet.config.ts focus=7:9
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {

    },
  },
});
```

---

The Snaplet Data Client exposes all your models as functions. These functions return a plan. You always start from a root model, here we start from the `Post` model.

```ts snaplet.config.ts focus=8:10
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({

      });
    },
  },
});
```

---

You use the `data` key to define the values of your model.

```ts snaplet.config.ts focus=9:11
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
        },
      });
    },
  },
});
```

---

You can also define the values of your model's relations. Here we define the author of the post represented by the `User` model.

```ts snaplet.config.ts focus=11:18
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
        },
      });
    },
  },
});
```

---

Finally, we also define the comments of the post represented by the `Comment` model. As we need more than one comment, we use the `count` key. Again, note that we haven't defined any information about the comment authors, merely that we need three comments.

```ts snaplet.config.ts focus=19:21
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

---

We love it when a plan comes together!

Copy the code above and add it to your `snaplet.config.ts` file.

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

</CH.Scrollycoding>

### Executing the plan

At this point, you're ready to run your first `snaplet generate`!

Let's see what statements are generated by using the `--sql` option.

Run this command in your terminal:

```bash >_&nbsp;terminal
snaplet generate --sql
```

You should see the following output:

<CH.Slideshow className="generate-tutorial-sql-output">

Click the '**Next**' button on the slider above to see a step-by-step explanation of this output.

```sql >_&nbsp;terminal
INSERT INTO public."User" (email,id,username) VALUES
('Craig.Bednar82365@acme.org', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', 'site-glance56860'),
('Humberto.Bruen34274@meternephew.org', '241ed1d9-c36c-50d4-b783-e12ce5187076', 'Alexis-Gleason29168'),
('Mattie.Braun26688@plodantechamber.com', '8c84c800-1b34-5843-b34b-73d3239f0c5b', 'blissful-fountain21234'),
('Dannie_Osinski74665@brownmidline.name', '0e041e68-00c0-53db-b0f8-e28be8a009e0', 'visualise-service97805');

INSERT INTO public."Post" (title,content,"createdBy",id) VALUES
('Hello World!', 'Ramo ramukin rae racea rakesoma, me vayota yume vi keyo munavima.', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf');

INSERT INTO public."Comment" (content,id,"postId","userId","writtenAt") VALUES
('Ma ceasova yuviketa shira chiyomu.', '13fdf8d2-2199-5dfd-81d0-c8dd3ce3b8a6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '241ed1d9-c36c-50d4-b783-e12ce5187076', DEFAULT),
('Mukinra kahyceako kiva kai me hameso rae.', '71a504eb-a859-5217-9e27-e15975ac69c6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '8c84c800-1b34-5843-b34b-73d3239f0c5b', DEFAULT),
('Ma nacea va memumi ta, mami viyua yoma shimusona viyo metake.', '8e826b31-f774-57f3-8ef2-183bddb35f3e', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '0e041e68-00c0-53db-b0f8-e28be8a009e0', DEFAULT);
```

---

This is the post, titled "Hello World!" as intended.

```sql >_&nbsp;terminal focus=8

```

---

This is the author of the post, notice the "acme.org" in the email.

```sql >_&nbsp;terminal focus=2

```

---

And here are the 3 comments.

```sql >_&nbsp;terminal focus=11:13

```

---

As mentioned earlier, these 3 users were automatically generated to satisfy the requirement of 3 comments. You didn't need to define them - the Snaplet Data Client did it for you, because it knows your schema relationships and can fulfill them automatically.

```sql >_&nbsp;terminal focus=3:5

```

</CH.Slideshow>

It's now time to seed this data into your database.

In order to do that, run this command in your terminal:

```bash >_&nbsp;terminal
snaplet generate
```

All done, you're now ready to code against your generated data! 


## Next steps
Learn more about how Snaplet `generate` works and define more complex plans in our [generate reference guide](/core-concepts/generate)